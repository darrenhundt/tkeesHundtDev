<script>
      function completeYourLookCart(product_id,color,allproductsCart,vendor){ 
            document.getElementById("suggestion_main").innerHTML = '';  
            sessionStorage.setItem("Session_color", color);  
            var scriptUrl = "http://tkeesconnections.appspot.com/ShowBagJson/"+product_id+"/"+color;
             console.log(scriptUrl);
            $.ajax({
              url: scriptUrl,
              type: 'get',
              dataType: 'json',
              async: true,
              success: function(data) {
                
          		var allproduct =  [{"id" : 0, "price" : "$", "title" : "a" } 
                                   {% paginate collections.all.products by 1000 %}
                                   {% for product in collections.all.products %}
                                       ,{"id" : {{ product.id }} , "price" : "{{ product.price | money | replace: '"', '' }}" ,"title" : "{{ product.title}}", "available" : "{{product.available }}" , "compare_at_price" : "{{ product.compare_at_price | money | replace: '"', '' }}" }
                                   {% endfor %}
                                   {% endpaginate %}                                       
                                  ];                

                var result = data;                          
                var products = result.data;
                //console.log('xpto');
                //console.log(products);

            if (vendor == 'Footwear'){
                var count_b = 0;
                var count_Footwear = 0;
                var count_Clothing = 0;
                var all_prod_cart =''; 
                for (i = 0; i < products.length; i++) {  
                       var substring = '' + products[i].product_id;
                       if (!(allproductsCart.includes(substring))){
                          if ((products[i].other_type_product == 'Footwear') && (count_Footwear < 4) ) {
                              count_Footwear++;
                              console.log('Footwear ' + count_Footwear);
                              all_prod_cart =  all_prod_cart + '  ' + products[i].product_id ;
                          }else if ((products[i].other_type_product == 'Clothing') && (count_Clothing < 1) ) {
                              var all_prod_cart =  all_prod_cart + '  ' + products[i].product_id ; 
                              count_Clothing++;
                              console.log('Clothing ' + count_Clothing);
                          }                    

                          count_b = count_Footwear +  count_Clothing;
                          console.log('Total ' + count_b); 
                          if (count_b == 4){
                            console.log('is 3');
                            break;
                          }
                          
                       }  
                }
         } 

        if (vendor == 'Clothing'){
                var count_b = 0;
                var count_Footwear = 0;
                var count_Clothing = 0;
                var all_prod_cart =''; 
                for (i = 0; i < products.length; i++) {  
                       var substring = '' + products[i].product_id;
                       if (!(allproductsCart.includes(substring))){
                          if ((products[i].other_type_product == 'Clothing') && (count_Clothing < 4) ) {
                              count_Clothing++;
                              console.log('Clothing ' + count_Clothing);
                              all_prod_cart =  all_prod_cart + '  ' + products[i].product_id ;
                          }else if ((products[i].other_type_product == 'Footwear') && (count_Footwear < 1) ) {
                              var all_prod_cart =  all_prod_cart + '  ' + products[i].product_id ; 
                              count_Footwear++;
                              console.log('count_Footwear ' + count_Footwear);
                          }                    

                          count_b = count_Footwear +  count_Clothing;
                          console.log('Total ' + count_b); 
                          if (count_b == 4){
                            console.log('is 3');
                            break;
                          }
                          
                       }  
                }
         } 

        if ((vendor != 'Clothing') && (vendor != 'Footwear')) {
                var count_b = 0;
                var count_Footwear = 0;
                var count_Clothing = 0;
                var all_prod_cart =''; 
                for (i = 0; i < products.length; i++) {  
                          var all_prod_cart =  all_prod_cart + '  ' + products[i].product_id ; 
                          count_Footwear++;
                          count_b = count_Footwear +  count_Clothing;
                          console.log('Total ' + count_b); 
                          if (count_b == 4){
                            console.log('is 3');
                            break;
                          }   
                }
         } 
                

                
                                                         
                var strhtml =  '<div class="suggestion_title" ><p class="product_suggestion_title">  '+products[0].form_title+'  </p>   </div>';            
                strhtml = strhtml +    '<div class="container1">';
                var javaScriptCode='';      
                var count_b = 0;
                var count_vendor = 0;
				for (i = 0; i < products.length; i++) {  
                   console.log('allproductsCart');
                   console.log(allproductsCart);
                   console.log(products[i].product_id); 

                   var substring = '' + products[i].product_id;
                   console.log(allproductsCart.includes(substring))
                   if ((all_prod_cart.includes(substring))){

                      if (vendor ==  products[i].other_type_product){
                          console.log(products[i].other_type_product)
                      }else{
                          console.log(products[i].other_type_product)
                      }
                     
                      console.log(count_b);
                       
                      if (count_b == 4){
                        console.log('is 3');
                        break;
                      }
                      count_b++;
                           for (var w = 0; w < allproduct.length; w++){
                                if (allproduct[w].id == products[i].product_id){
                                              var price   		   =  allproduct[w].price;  
                                              var compare_at_price =  allproduct[w].compare_at_price;  
                                }
                            }     
                                           
                           strhtml = strhtml +   ' <div class="dummyInline" >';   
                           strhtml = strhtml +    '  <form id="suggestionForm'+i+'">';
                           strhtml = strhtml +    '         <div class="suggestion_col1" >';
                           strhtml = strhtml +    '           <div id="theImageSpan'+i+'" style="width: 100%; height: 100%; position:relative;">';
        
                                      
        				   strhtml = strhtml +    '           <div id="soldoutornot'+i+'"></div>' ;  

                          var colors = products[i].colors;
                          var count_select =0;
                          for (j = 0; j < colors.length; j++) {  
                                console.log(colors[j].selected);
                                if((count_select<1)&&(colors[j].selected == 'selected')){ 
                                  selected_src = colors[j].src;
                                }  
                                if (colors[j].selected == 'selected'){ 
                                 count_select++;
                                }
                          }                     
  
  
        
                           if (count_select>0){
                             strhtml = strhtml +    '           <img src="'+selected_src+'" width="100%" >';
                           }
                           else{
                             strhtml = strhtml +    '           <img src="'+products[i].src+'" width="100%" >';
                           }
                     
                        
                        
                   
                        
                        
                        
                           strhtml = strhtml +    '           </div>';
                           strhtml = strhtml +    '         </div>';
                           strhtml = strhtml +    '         <div class="suggestion_col2" >';
                           strhtml = strhtml +    '             <div class="sugestion_title" >';
                           strhtml = strhtml +    '               <label class="sugestion_product">'+products[i].title+'</label>';
                        
                           strhtml = strhtml +    '                 <input id="product_'+i+'" name="product_'+i+'"  type="hidden" value="'+products[i].product_id+'">';                
                        
                           strhtml = strhtml +    '             </div>';
                           strhtml = strhtml +    '             <div class="suggestion_Size" >';
                           strhtml = strhtml +    '                  <label class="label_Size">Color</label>';
                        
                       
                           var colors = products[i].colors;
                        
                           strhtml = strhtml +  '<select name="color_'+i+'" id="color_'+i+'" class="suggestion_select" onChange="changeimage_'+i+'();" ';
                           strhtml = strhtml +  ' <optgroup>  <option value="" class="service-small">Select your color</option> ';
                                var count_select = 0;
                                for (j = 0; j < colors.length; j++) {  
                                      
                                      if(count_select<1){ 
                                        strhtml = strhtml + '<option value="'+colors[j].color+'" '+colors[j].selected+' class="service-small">'+colors[j].color+'</option>';
                                      }else{
                                        strhtml = strhtml + '<option value="'+colors[j].color+'" class="service-small">'+colors[j].color+'</option>';
                                      }  
                                      if (colors[j].selected == 'selected'){ 
                                       count_select++;
                                      }
                                }
                           strhtml = strhtml +  '</optgroup></select>';
                           strhtml = strhtml +    '             </div>';
                           strhtml = strhtml +    '           <div class="suggestion_Size" >';
                           strhtml = strhtml +    '                 <label class="label_Size">Size <span id="quantityNow'+i+'"></span> </label> ';
                           var sizes = products[i].sizes;
                           strhtml = strhtml +  '<select name="size_'+i+'" id="size_'+i+'" class="suggestion_select" onChange="changeVariantID_'+i+'();">';
                           strhtml = strhtml +  '<optgroup>   <option value="">Select your size</option> ';
                                for (j = 0; j < sizes.length; j++) {  
                                      strhtml = strhtml + '<option value="'+sizes[j].size+'" >'+sizes[j].size+'</option>';
                                }
                           strhtml = strhtml +  '</optgroup></select>';                
                           strhtml = strhtml +    '           </div>';
                           strhtml = strhtml +    '                 <input id="variants_'+i+'" name="variants_'+i+'"  type="hidden" value="">';
                           strhtml = strhtml +    '<div class="suggestion_Size" id="suggestion_button'+i+'" >';
                           strhtml = strhtml +    '           <div id=addbutton'+i+'> ';
                           strhtml = strhtml +    ' 				<label name="add-suggestion" id="add-suggestion" class="btn js-no-transition js-drawer-open-cart"  style="width : 100% !important" disabled>Add - '+price+'</label>';
          				   strhtml = strhtml +    '           </div>';
                        
                        
        
                           strhtml = strhtml +    "           <div id=addwaitlist"+i+" style='display: none;'>  <label class='btn js-no-transition waitList' style='width : 100% !important'><center><a href='#' class='BIS_trigger waitList' data-product-data='"+productDetails(products[i].product_id)+"'>  ";
                           strhtml = strhtml + 	  "SOLD OUT</a></center></label>";
                           strhtml = strhtml + 	  "           </div> " ;  
                        
                           strhtml = strhtml +    '</div>';
                        
                        
                        
                        
                           strhtml = strhtml +    '       </div>';
                           strhtml = strhtml +    '   </form> <div class="suggestion_line">&nbsp;</div>';
                           strhtml = strhtml +    '</div>';
         
                            var arraycolor = '{"color" : "" , "scr" : "" }';
                            for (j = 0; j < colors.length; j++) {  
                              arraycolor =  arraycolor + ',{"color" : "'+colors[j].color+'" , "src" : "'+colors[j].src+'" }' ;
                            }
        
                           javaScriptCode = javaScriptCode +    ' function changeimage_'+i+'(){';
                           javaScriptCode = javaScriptCode + 		' console.log("test");';
                           javaScriptCode = javaScriptCode + 		' var test = addCplInsights('+products[i].product_id+',"'+products[i].title+'","Size Interaction");';                     
                           javaScriptCode = javaScriptCode + 		" var colors = '["+arraycolor+"]';";
                           javaScriptCode = javaScriptCode + 		'  var jsonObj = JSON.parse(colors);';
                       
                           javaScriptCode = javaScriptCode + 		' var thecolor = $("#color_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var thesize = $("#size_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var theproduct = $("#product_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var thetitle = theproduct + thecolor + " / " + thesize;';
                        
                           javaScriptCode = javaScriptCode + 		' var variant_id = searchVariant(thetitle);';       
                           javaScriptCode = javaScriptCode + 		' $("#variants_'+i+'").val(variant_id);';  
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';
            
                           javaScriptCode = javaScriptCode + 		' thetitle = theproduct + thecolor;';  
                           javaScriptCode = javaScriptCode + 		' var src   = searchVariantbyColor(thetitle);';    
                           javaScriptCode = javaScriptCode + 		'$("#theImageSpan'+i+'").html("<div id=soldoutornot'+i+'></div><img src="+src+" width=100% >");';
                        
                        
                           javaScriptCode = javaScriptCode + 		 ' total = all_variants(variant_id,"inventory"); ';
                        
                           javaScriptCode = javaScriptCode + 		'if(total>0){'; 
                           javaScriptCode = javaScriptCode + 		'   if(variant_id>0){'; 
                        
                        
                            javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();'; 
                        
                           javaScriptCode = javaScriptCode + 		'     document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"     '<label name=add-suggestion id=add-suggestion" + ' style=width:100%; class="btn js-no-transition js-drawer-open-cart" ' + "onclick=addtocartSuggestion_"+i+"();>Add - "+price+"</label>'" ;             
                           javaScriptCode = javaScriptCode + 		'   }else{';
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                 
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();';                 
                           javaScriptCode = javaScriptCode + 		'     document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"   '<label name=add-suggestion id=add-suggestion " + ' class="btn js-no-transition"   style=width:100%;  disabled>Add - '+price+'</label>'+"';" ;     
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';
                           javaScriptCode = javaScriptCode + 		'   }  ';  
        
                           javaScriptCode = javaScriptCode + 		'}else{';       
                        
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").hide();'; 
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").show();';                 
         
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "&nbsp;SOLD OUT&nbsp;";';
                           javaScriptCode = javaScriptCode + 		'$("#soldoutornot'+i+'" ).addClass( "tag_soldout" );';                
        
                      
                        
                           javaScriptCode = javaScriptCode +        '} ';        
        
                        
        
                        
                           javaScriptCode = javaScriptCode + 		'if(total >0){'; 
                        
                           javaScriptCode = javaScriptCode + 		'if((total >= 5) && (total <= 10)){'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "&nbsp;- Only A Few Left";'; 
                           javaScriptCode = javaScriptCode + 		'}else if(total < 5){'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "&nbsp;- "+total+" Left";'; 
                           javaScriptCode = javaScriptCode + 		'} else {'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "";'; 
                           javaScriptCode = javaScriptCode + 		'}  ';                  
                           javaScriptCode = javaScriptCode + 		'} else {'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "";'; 
                           javaScriptCode = javaScriptCode + 		'}  ';                     
                        
                        
                           javaScriptCode = javaScriptCode +        'console.log(variant_id); ';    
                           javaScriptCode = javaScriptCode + 		'if(variant_id==0){'; 
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                 
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();'; 
                           javaScriptCode = javaScriptCode + 		' document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"   '<label name=add-suggestion id=add-suggestion " + ' class="btn js-no-transition"   style=width:100%;  disabled>Add - '+price+'</label>'+"';" ;   
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';   
                           javaScriptCode = javaScriptCode +        '} ';                 
                                        
                        
                           javaScriptCode = javaScriptCode +    '  } '; 
                           
                  
                        
                           javaScriptCode = javaScriptCode +    ' function changeVariantID_'+i+'(){';
                           javaScriptCode = javaScriptCode + 		' var test = addCplInsights('+products[i].product_id+',"'+products[i].title+'","Size Interaction");';                     
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';                
                           javaScriptCode = javaScriptCode + 		' var thecolor = $("#color_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var thesize = $("#size_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var theproduct = $("#product_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var thetitle = theproduct + thecolor + " / " + thesize;';
                           javaScriptCode = javaScriptCode + 		' var variant_id = searchVariant(thetitle);';
                           javaScriptCode = javaScriptCode + 		' $("#variants_'+i+'").val(variant_id);';   
                        
                        
                           javaScriptCode = javaScriptCode + 		 ' total = all_variants(variant_id,"inventory"); ';
                        
                           javaScriptCode = javaScriptCode + 		'if(total>0){'; 
                           javaScriptCode = javaScriptCode + 		'   if(variant_id>0){'; 
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                 
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();';                 
                           javaScriptCode = javaScriptCode + 		'     document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"     '<label name=add-suggestion id=add-suggestion" + '   style=width:100%; class="btn js-no-transition js-drawer-open-cart" ' + "onclick=addtocartSuggestion_"+i+"();>Add - "+price+"</label>';" ;  
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';     
                           javaScriptCode = javaScriptCode + 		'   }else{';
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                 
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();';                 
                           javaScriptCode = javaScriptCode + 		'     document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"   '<label name=add-suggestion id=add-suggestion " + '   style=width:100%;  class="btn js-no-transition" disabled>Add - '+price+'</label>'+"';" ;  
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';                    
                           javaScriptCode = javaScriptCode + 		'   }  ';  
        
                           javaScriptCode = javaScriptCode + 		'}else{';               
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").hide();'; 
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").show();'; 
                          
                        
        
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "&nbsp;SOLD OUT&nbsp;";';
        
                           javaScriptCode = javaScriptCode + 		'$("#soldoutornot'+i+'" ).addClass( "tag_soldout" );';                
                        
                        
                           javaScriptCode = javaScriptCode +        '} ';         
                        
                        
                        
                        
                           javaScriptCode = javaScriptCode + 		'if(total >0){'; 
                        
                           javaScriptCode = javaScriptCode + 		'if((total >= 5) && (total <= 10)){'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "&nbsp;- Only A Few Left";'; 
                           javaScriptCode = javaScriptCode + 		'}else if(total < 5){'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "&nbsp;- "+total+" Left";'; 
                           javaScriptCode = javaScriptCode + 		'} else {'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "";'; 
                           javaScriptCode = javaScriptCode + 		'}  ';                  
                           javaScriptCode = javaScriptCode + 		'} else {'; 
                           javaScriptCode = javaScriptCode + 		'    document.getElementById("quantityNow'+i+'").innerHTML = "";'; 
                           javaScriptCode = javaScriptCode + 		'}  ';                   
                        
                           javaScriptCode = javaScriptCode +        'console.log(variant_id); ';   
                           javaScriptCode = javaScriptCode + 		'if(variant_id==0){'; 
                           javaScriptCode = javaScriptCode + 		'   $("#addwaitlist'+i+'").hide();';                  
                           javaScriptCode = javaScriptCode + 		'   $("#addbutton'+i+'").show();';                 
                           javaScriptCode = javaScriptCode + 		' document.getElementById("addbutton'+i+'").innerHTML = ';
                           javaScriptCode = javaScriptCode + 		"   '<label name=add-suggestion id=add-suggestion class=btn disabled   style=width:100%; >Add - "+price+"</label>';" ;
                           javaScriptCode = javaScriptCode + 		' document.getElementById("soldoutornot'+i+'").innerHTML = "";';                
                        
                           javaScriptCode = javaScriptCode +        '} ';                  
                        
                        
                           javaScriptCode = javaScriptCode +    '  } '; 
                        
                        
        
                        
                             javaScriptCode = javaScriptCode +    ' function addtocartSuggestion_'+i+'(){';
                           javaScriptCode = javaScriptCode + 		'  addtocartSuggestion($("#variants_'+i+'").val());';
                           javaScriptCode = javaScriptCode +    '  } '; 
                        
                           
                           javaScriptCode = javaScriptCode +    ' function openbiswindow'+i+'(){';
                           javaScriptCode = javaScriptCode + 		' var variantId = $("#variants_'+i+'").val();';
                           javaScriptCode = javaScriptCode + 		' var productId = $("#product_'+i+'").val();';  
                        
                           javaScriptCode = javaScriptCode +    '     console.log(variantId); '; 
                           javaScriptCode = javaScriptCode +    '     console.log(productId); '; 
                        
                           javaScriptCode = javaScriptCode +    '  } '; 

                   }
                
                
                }  

                strhtml = strhtml +    '</div>';
                var variants = result.variants;  
                
                   
                    var arrayVARIANTS = '{"id" : "" , "title" : "" , "product_id_color" : "" }';
                    for (j = 0; j < variants.length; j++) {  
                      arrayVARIANTS =  arrayVARIANTS + ',{"id" : "'+variants[j].variant_id+'" , "title" : "'+variants[j].product_id + variants[j].title+'" , "product_id_color" : "'+variants[j].product_id + variants[j].color +'" }' ;
                    }                   
                   

                   
               javaScriptCode = javaScriptCode +    ' function searchVariant(thetitle){';
               javaScriptCode = javaScriptCode + 		" var variants = '["+arrayVARIANTS+"]';";
               javaScriptCode = javaScriptCode + 		'  var jsonObj = JSON.parse(variants);';
               javaScriptCode = javaScriptCode + 		'  try {';      
               javaScriptCode = javaScriptCode + 		'    var variant_id = jsonObj.find(x => x.title == thetitle).id;';      
               javaScriptCode = javaScriptCode + 		'  } catch(e) {';    
			   javaScriptCode = javaScriptCode + 		'    var variant_id = 0;';                    
 			   javaScriptCode = javaScriptCode + 		'  } ';                                     
               javaScriptCode = javaScriptCode + 		' return variant_id;';
               javaScriptCode = javaScriptCode +    '  } ';                    
                                     

                   
               javaScriptCode = javaScriptCode +    ' function searchVariantbyColor(thecolor){';
               javaScriptCode = javaScriptCode + 		" var variants = '["+arrayVARIANTS+"]';";
               javaScriptCode = javaScriptCode + 		'  var jsonObj = JSON.parse(variants);';
               javaScriptCode = javaScriptCode + 		'  var variant_id = jsonObj.find(x => x.product_id_color == thecolor).id;';      
               javaScriptCode = javaScriptCode + 		'  var src = all_variants(variant_id,"image");';      
               javaScriptCode = javaScriptCode + 		'  return src;';
               javaScriptCode = javaScriptCode +    '  } ';                       
 
                   //console.log(strhtml);
				document.getElementById("suggestion_main").innerHTML = strhtml ;                                   
                                         
              
              
                addScript('inject',javaScriptCode);
              
                
              } 
            });            
           
                                   
    }      
 
    function addScript(inject,code) {
      var _in = document.getElementById('inject');
      var scriptNode = document.createElement('script');
      scriptNode.innerHTML = code;
      _in.appendChild(scriptNode);
    }  
  
  
    function addtocartSuggestion(variant){
          console.log('the cart item is => ' + variant);
          var items = [
              { quantity: 1, id: variant , tags: 'cpl_form' }
            ];
          $.ajax({
            type: "POST",
            url: '/cart/add.json',
            data: { items: items },
            success: function(data) {
              console.log('success');
            },
            dataType: 'application/json'
          });
          setTimeout(function() {
            jQuery.getJSON('/cart.js', function(cart) {
    		 let cartData = cart.items;

             var test = addcarthistory(variant, cart.token);
              
             document.dispatchEvent(new CustomEvent('cart:build'  , {bubbles: true}));               
             document.dispatchEvent(new CustomEvent('cart:refresh', {
                bubbles: true,
                detail: cartData
              }));                
        	});
            location.reload();
            
          }, 400);   
      
         console.log('Simulating Click');
      
         // setTimeout(function() {
         //document.querySelector('#cart-number').click();

        //  addToCartOk_CPL_Look(variant);
           
         //}, 800);   
      
      }      
      
  function addcarthistory(variant,token){
    console.log(variant);
    console.log(token);
    var scriptUrl = "https://tkeesconnections.appspot.com/storageInfoCPL/"+variant+"/"+token+"/cart/cplook/";
    console.log(scriptUrl);
    $.ajax({
      url: scriptUrl,
      type: 'get',
      dataType: 'json',
      async: true,
      success: function(data) {
          console.log("insert data to cplook table"); 
      } 
    });      
    return 'ok';
  }  
  
  function addCplInsights(product_id,title,desc){
    console.log(product_id);
    console.log(title);
    console.log(desc);
    var scriptUrl = "https://tkeesconnections.appspot.com/storageinsightsCPL/"+title+"/"+desc+"/0/cart/"+product_id;
    console.log(scriptUrl);
    $.ajax({
      url: scriptUrl,
      type: 'get',
      dataType: 'json',
      async: true,
      success: function(data) {
          console.log("insert data to cplook table"); 
      } 
    });      
    return 'ok';
  }    
  
  function all_variants(theid,searching){
      var allvariants =  [{"id" : 0, "price" : "$", "inventory_quantity" : "a" } 
                        {% paginate collections.all.products by 1000 %}
                        {% for product in collections.all.products %}
                         {% for variant in product.variants %} 
                          ,{"id" : {{ variant.id }} , "image_id" : "{{ variant.image | img_url: '720x720' }}" , "price" : "{{ variant.price | money | replace: '"', '' }}" ,"inventory_quantity" : "{{ variant.inventory_quantity}}", "compare_at_price" : "{{ variant.compare_at_price | money | replace: '"', '' }}" }
                         {% endfor %} 
                        {% endfor %}
                        {% endpaginate %}                           
                         ];           
                             

                             
                             
     if (searching == 'image') {                              
       try {    
       		var image = allvariants.find(x => x.id == theid).image_id;     
       }catch(e) {    
		    var image = 0;                    
       }                                  
       return image;
     }else{
       try {    
       		var inventory_quantity = allvariants.find(x => x.id == theid).inventory_quantity;     
       }catch(e) {    
		    var inventory_quantity = 0;                    
       }                                  
       return inventory_quantity;                   
     }
  }
  
 
  

    function productDetails(theid){
            

          var scriptUrl = "https://tkeesconnections.appspot.com/showProduct_datails/"+theid;
          console.log(scriptUrl);
          $.ajax({
            url: scriptUrl,
            type: 'get',
            dataType: 'json',
            async: false,
            success: function(data) {
                const myJSON = JSON.stringify(data);
                const withoutFirstAndLast = myJSON.slice(1, -1);
                console.log(data); 
                console.log(withoutFirstAndLast); 
                          
                          
                sessionStorage.setItem("withoutFirstAndLast", withoutFirstAndLast );   
            } 
          });                            
                          
          return sessionStorage.getItem("withoutFirstAndLast");                 
                          
                          
  }
  
  
  
  
</script>  