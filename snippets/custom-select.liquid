{% comment %}
  Parameters:
  - id {string} [required] - A unique id.
  - option_values {Array} [required] - Option values.
  - option_names {Array} [optional] - Option names. If not supplied, values will be used.
  - selected_value {string} [optional] - The value of the selected option
  - label {string} [optional] - Label text. If not supplied, a label must be rendered separately with
      an id that matches the 'id' parameter.
  - label_inside {boolean} [optional] - Whether the label should be inside the select box. Default is false.
  - hide_label [optional] - Whether to visually hide the label. Default is false.
  - swatches {boolean} [optional] - Whether the select element is a colour selector with swatches enabled. Default is false.
  - include_native {boolean} [optional] - Whether a native select element should be included (hidden). Default is false.
  - native_name {string} [optional] - A unique name for the native select element (if included).
  - native_form_id {string} [optional] - Associated form for the native select element.
  - blank_option {string} [optional] - Include a blank option before other options, using the string provided as the name.

  Example usage:
  render 'custom-select',
    id: 'colour-selector',
    option_values: ['Blue', 'Green', 'Red'],
    selected_value: 'Red',
    label: 'Colour',
    swatches: true
{% endcomment %}

{%- liquid
  assign label_id = id | append: '-label'

  if option_names == blank
    assign option_names = option_values
  endif

  if blank_option != blank and selected_value == ''
    assign selected_id = id | append: '-opt-blank'
    assign selected_name = blank_option
  elsif selected_value
    for value in option_values
      if value == selected_value
        assign selected_id = id | append: '-opt' | append: forloop.index0
        assign selected_name = option_names[forloop.index0]
      endif
    endfor
  endif

  assign selector_text = ''
  assign found_match = false
  assign current_date = 'now' | date: '%Y-%m-%d'
  for presale_info in shop.metaobjects.presale_info.values
    if found_match
      break
    endif
    assign display_until_date = presale_info.display_until.value
    assign products_raw_string = presale_info.products
    assign products_gids = products_raw_string | remove: '[' | remove: ']' | remove: '"' | split: ','
    for product_gid in products_gids
      assign metaobject_product_id = product_gid | split: '/' | last | plus: 0
      if metaobject_product_id == product.id and current_date <= display_until_date
        assign selector_text = presale_info.short_text.value
        assign found_match = true
        break
      endif
    endfor
  endfor
-%}

{%- if label -%}
  {%- capture label_html -%}
    <label id="{{ label_id }}" class="label{% if hide_label %} visually-hidden{% endif %} no-js-hidden">{{ label }}</label>
  {%- endcapture -%}
  {%- unless label_inside -%}{{ label_html }}{%- endunless -%}
{%- endif -%}
<div class="cc-select{% if label_inside %} cc-select--label-inside{% endif %} no-js-hidden" id="{{ id }}">
  {%- if label and label_inside -%}{{ label_html }}{%- endif -%}
  <button
    class="cc-select__btn"
    type="button"
    aria-haspopup="listbox"
    aria-labelledby="{{ label_id }}"
    {% if swatches and selected_value != blank %}
      data-swatch="{{ selected_value | replace: '"', '' | downcase }}"
    {% endif %}
  >
    {{- selected_name -}}
    <svg
      class="cc-select__icon"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      aria-hidden="true"
    >
      <polyline points="6 9 12 15 18 9"></polyline>
    </svg>
  </button>
  <ul
    class="cc-select__listbox"
    role="listbox"
    tabindex="-1"
    aria-hidden="true"
    {% if selected_value %}
      aria-activedescendant="{{ selected_id }}"
    {% endif %}
  >
    {%- if blank_option != blank -%}
      <li
        class="cc-select__option js-option"
        id="{{ id }}-opt-blank"
        role="option"
        data-value=""
        {% if selected_value == blank %}
          aria-selected="true"
        {% endif %}
      >
        <!-- -span>{{- blank_option -}} aaaaaaaaaaa</span- -->
        <span>Select size</span>
      </li>
    {%- endif -%}

    {% if product.tags contains 'only-few-left' %}
      {% assign has_only_few_left = 'yes' %}
    {% else %}
      {% assign has_only_few_left = 'no' %}
    {% endif %}

    {%- for value in option_values -%}
      {% assign var1 = inventory_quantity[forloop.index0] | plus: 0 %}
      {% assign var2 = pre_order[forloop.index0] | plus: 0 %}
      <li
        class="{% if product.metafields.custom.hide_bis_button_ii == 'yes' and var1 < 1  and  var2 < 1 %} sold-out-item  {%  endif %} cc-select__option js-option "
        id="{{ id }}-opt-{{ forloop.index0 }}"
        role="option"
        onClick="showComment2({{ variant_ids[forloop.index0] }});"
        data-value="{{ value | escape }}"
        {% if swatches %}
          data-swatch="{{ value | replace: '"', '' | downcase }}"
        {% endif %}
        {% if value == selected_value %}
          aria-selected="true"
        {% endif %}
        disabled
      >
        <!-- this change is for add the inventory quantity side by side with the size /  START -->
        <span class="displaysizemessage">
          <div class="sizename">{{- option_names[forloop.index0] -}}</div>
          <div
            class="sizemessage"
            {% if var1 < 1 %}
            {%- endif -%}
          >
            {% assign var1 = inventory_quantity[forloop.index0] | plus: 0 %}
            {% assign var2 = pre_order[forloop.index0] | plus: 0 %}
            {% if var1 >= 5 and var1 <= 10 and has_only_few_left == 'no' and var2 < 1 %}
              <label style="display:none;"> &mdash; </label> Only A Few Left
            {%- endif -%}
            {% if var1 >= 5 and has_only_few_left == 'yes' and var2 < 1 %}
              <label style="display:none;"> &mdash; </label> Only A Few Left
            {%- endif -%}
            {% if var1 < 5 and var1 > 0 and var2 < 1 %}
              <label style="display:none;"> &mdash; </label> Only {{ inventory_quantity[forloop.index0] }} Left
            {%- endif -%}
            {% if var1 < 1 and var2 < 1 %}
              <font color="#982F36">
                <label style="display:none;"> &mdash; </label>
                {% if product.metafields.custom.hide_bis_button_ii == 'yes' %}
                  Sold out
                {% else %}
                  Notify Me
                {%- endif -%}
              </font>
            {%- endif -%}
            {% if var2 > 0 %}
              <label style="display:none;"> &mdash; </label> Pre order
            {%- endif -%}
          </div>
          <!-- this change is for add the inventory quantity side by side with the size /  END OF THE CODE -->
        </span>
        <!-- Presale info -->
        {% if var1 > 0 or var2 > 0 %}
          <span
            class="presale-info"
            data-found-match="{{ found_match }}"
          >
            {{- selector_text -}}
          </span>
        {% endif %}
      </li>
    {%- endfor -%}
  </ul>
</div>

{%- if include_native -%}
  {%- if label -%}
    <label for="{{ id }}-native" class="label{% if hide_label %} visually-hidden{% endif %} js-hidden">
      {{- label -}}
    </label>
  {%- endif -%}
  <select
    class="js-hidden"
    id="{{ id }}-native"
    {% if native_name %}
      name="{{ native_name }}"
    {% endif -%}
    {% if native_form_id %}
      form="{{ native_form_id }}"
    {% endif %}
  >
    {%- if blank_option != blank -%}
      <span>Select size</span>
    {%- endif -%}
    {%- for value in option_values -%}
      <option
        value="{{ value | escape }}"
        {% if value == selected_value %}
          selected
        {% endif %}
      >
        {{- option_names[forloop.index0] -}}
      </option>
    {%- endfor -%}
  </select>
{%- endif -%}
